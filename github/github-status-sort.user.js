// ==UserScript==
// @name                 GitHub Status Checks
// @author               Hamid Zare
// @description          Reorder GitHub status checks.
// @grant                none
// @icon                 https://www.google.com/s2/favicons?sz=64&domain=github.com
// @match                https://github.com/*/*/pull/*
// @namespace            http://tampermonkey.net/
// @version              0.1.0
// ==/UserScript==

'use strict';

    (()=>{function t(t,n,e,r){Object.defineProperty(t,n,{get:e,set:r,enumerable:!0,configurable:!0})}var n={};t(n,"defaulted",()=>s),t(n,"expose",()=>l),t(n,"expandSels",()=>f),t(n,"addStyle",()=>p),t(n,"addStyles",()=>h),t(n,"listenForSpeech",()=>v),t(n,"disableVisibilityApis",()=>y);var e={};t(e,"UserError",()=>i),t(e,"MissingSupport",()=>u);var r=function(){var t=function(n,e){return(t=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),o=function(t){function n(n){return t.call(this,n)||this}return r(n,t),n}(Error),i=function(t){function n(n){return t.call(this,n)||this}return r(n,t),n}(o),u=function(t){function n(n){return t.call(this,n)||this}return r(n,t),n}(o),c=function(){return(c=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},a=new Set,s=function(t,n){return c(c({},n),t)},l=function(t,n,e){var r=t?window[t]||{}:window;for(var o in e=s(e),n)(o in r||a.has("".concat(t,".").concat(o)))&&console.error("".concat(t,", key ").concat(o," is already exposed")),a.add("".concat(t,".").concat(o));t?(Object.assign(r,n),window[t]=r):Object.assign(window,n)},f=function(t){for(var n=0,e=Object.entries(t);n<e.length;n++){var r=e[n],o=r[0],i=r[1];if("string"==typeof i){if(i.startsWith("@")){var u=i.slice(1).split(" "),c=u[0],a=u.slice(1);if(!(c in t))throw Error("Could not find selector ".concat(i));t[o]=t[c]+" "+a.join(" ")}}else if("object"==typeof i)throw Error("Not implemented")}},d=function(t){var n="hstyles",e=document.getElementById(n);e||((e=document.createElement("style")).type="text/css",e.id=n,document.head.appendChild(e));var r=e.sheet;return r.insertRule(t,(r.rules||r.cssRules||[]).length),r},p=function(t,n){return d("".concat(t," { ").concat(n," }"))},h=function(t,n,e){return void 0===e&&(e=!1),p(t,n.map(function(t){return t+(e?" !important":"")}).join(";"))};function v(t){if(!("SpeechRecognition"in window||"webkitSpeechRecognition"in window))throw new e.MissingSupport("Your browser does not support the Speech Recognition API. Please try Chrome or Edge.");var n=new(window.SpeechRecognition||window.webkitSpeechRecognition),r="";return{finalTranscript:new Promise(function(e,o){n.onresult=function(n){for(var o=n.resultIndex;o<n.results.length;o++){var i=n.results[o][0].transcript,u=n.results[o].isFinal;t&&t(i,u),u&&(r+=i)}r&&e(r)},n.onerror=function(t){o(Error("Speech recognition error: ".concat(t.error)))},n.start()}),recognition:n}}var y=function(){Object.defineProperty(document,"hidden",{configurable:!0,get:function(){return!1}}),Object.defineProperty(document,"visibilityState",{configurable:!0,get:function(){return"visible"}})},b={};t(b,"flashEl",()=>P),t(b,"findAll",()=>O),t(b,"sleepUntil",()=>j),t(b,"find",()=>T),t(b,"findSiblingSelector",()=>C),t(b,"runMain",()=>q);var m=function(){return(m=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},g=function(t,n,e,r){return new(e||(e=Promise))(function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?o(t.value):((n=t.value)instanceof e?n:new e(function(t){t(n)})).then(u,c)}a((r=r.apply(t,n||[])).next())})},w=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(e)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=n.call(t,u)}catch(t){c=[6,t],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},S={cc:{},mp:{},_state:{},_parseData:{}},x={highlightColor:"rgba(255, 255, 0, 0.5)",defaultTimeout:2e3};S._data={};var E=function(t){t.style.display="none"},P=function(t){return g(void 0,void 0,void 0,function(){return w(this,function(n){return t.style.border="4px solid ".concat(x.highlightColor),setTimeout(function(){t.style.border=""},1e3),[2]})})};S.mp.focusAll=function(t,n,e){void 0===e&&(e=""),S.findAll(t).forEach(function(t){return g(void 0,void 0,void 0,function(){var r;return w(this,function(o){return(r=e&&t.querySelector(e)||t).innerText.match(n)||E(r),[2]})})})};var k=function(t){return"string"==typeof t?t:Array.isArray(t)?t.map(k).join("\n"):t instanceof Element?t.innerText:JSON.stringify(t)},O=function(t){return Array.from(document.querySelectorAll(t)).filter(function(t){return t instanceof HTMLElement})},j=function(t,n){return void 0===n&&(n=5e3),g(void 0,void 0,Promise,function(){var e;return w(this,function(r){return e=Date.now()+n,[2,new Promise(function(n,r){var o=function(){return g(void 0,void 0,void 0,function(){var i;return w(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,t()];case 1:return null!=(i=u.sent())?n(i):Date.now()>e?r(Error("timeout")):setTimeout(o,100),[3,3];case 2:return r(u.sent()),[3,3];case 3:return[2]}})})};o()})]})})},T=function(t,n){return g(void 0,void 0,Promise,function(){var e;return w(this,function(r){return(n=m({timeout:x.defaultTimeout},n)).timeout?[2,j(function(){return T(t,m(m({},n),{timeout:0}))},n.timeout)]:n.text?[2,O(t).find(function(t){return _(t,n)})]:[2,(e=document.querySelector(t))instanceof HTMLElement?e:null]})})},A=function(t,n){if((n=m({timeout:x.defaultTimeout},n)).timeout)return j(function(){return A(t,m(m({},n),{timeout:0}))},n.timeout);var e=document.getElementById(t);return Promise.resolve(e instanceof HTMLElement?e:null)},_=function(t,n){return!!(n=m({text:void 0},n)).text&&t.innerText.includes(n.text)},M=function(t,n){for(var e=t.nextElementSibling;e;){if(e instanceof HTMLElement&&n(e))return e;e=e.nextElementSibling}for(e=t.previousElementSibling;e;){if(e instanceof HTMLElement&&n(e))return e;e=e.previousElementSibling}return null},C=function(t,n){return M(t,function(t){return t.matches(n)})},q=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return g(void 0,void 0,void 0,function(){return w(this,function(e){return setTimeout(function(){return g(void 0,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),console.log("running main"),[4,t.apply(void 0,n)];case 1:return e.sent(),[3,3];case 2:return console.error(e.sent()),[3,3];case 3:return[2]}})})},1e3),[2]})})};S.beep=function(){new Audio(S._data.beep).play()};var L=function(t){try{t()}catch(t){}},R={},H=function(t,n,e){R[t]=setInterval(function(){return L(n)},e)},I=function(t,n,e,r){return new(e||(e=Promise))(function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var n;t.done?o(t.value):((n=t.value)instanceof e?n:new e(function(t){t(n)})).then(u,c)}a((r=r.apply(t,n||[])).next())})},D=function(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(e)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=n.call(t,u)}catch(t){c=[6,t],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},U=function(t,n,e){if(e||2==arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))},B={statusParent:".merge-status-list.js-updatable-content-preserve-scroll-position",status:".merge-status-item"};function F(t){return({failed:1,"in-progress":2,unknown:3,pending:4,skipped:5,passed:6})[t]}var G=function(t){return t.querySelector(".octicon-check")?"passed":t.querySelector(".octicon-x")?"failed":t.querySelector(".anim-rotate")?"in-progress":t.querySelector(".octicon-skip")?"skipped":t.querySelector(".octicon-dot-fill")?"pending":"unknown"},N=function(){return I(void 0,void 0,Promise,function(){var t,n,e;return D(this,function(r){switch(r.label){case 0:return[4,(0,b.find)(B.statusParent)];case 1:if(!(t=r.sent())||!(e=U([],n=Array.from(t.children),!0).sort(function(t,n){var e=G(t),r=G(n);return F(e)-F(r)})).some(function(t,e){return t!==n[e]}))return[2];return console.log("reordering statuses"),n.forEach(function(n){return t.removeChild(n)}),e.forEach(function(n){return t.appendChild(n)}),[2]}})})},J=function(){return I(void 0,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,(0,b.sleepUntil)(function(){return I(void 0,void 0,void 0,function(){return D(this,function(t){switch(t.label){case 0:return[4,(0,b.find)(B.statusParent)];case 1:return t.sent(),[2,(0,b.findAll)(B.statusParent+" "+B.status).length>5]}})})},1e4)];case 1:return t.sent(),[4,N()];case 2:return t.sent(),H("reorder",N,3e3),[2]}})})};J(),(0,n.expose)("gh",{reorderStatusChecks:N,setupMutationListener:function(){return I(void 0,void 0,void 0,function(){var t,n;return D(this,function(e){switch(e.label){case 0:return t=new MutationObserver(function(t,n){for(var e=0;e<t.length;e++)if("childList"===t[e].type){N();break}}),[4,(0,b.find)(".merge-status-list")];case 1:return n=e.sent(),t.observe(n,{childList:!0}),[2]}})})},main:J,intervals:R})})();